# <center>数据库引论实验报告</center>

[TOC]

## 1 项目介绍

### 1.1 项目背景

　　Cat-World是为所以喜欢撸猫的人设计的一个猫咪养成类网页小游戏。以Django框架来实现整体功能。游戏中可以有两类角色，主人和商店管理者。主人可以在商店中购买食物并在公园里给野生的猫咪喂食，当好感度达到一定值时就可以领养小猫；商店管理者则主要是管理商店的货物，可以调整货物价格以及进货情况。

### 1.2 分工情况

|  |  |  |
| :--: | :--: | :--: |
| 罗翔 | 17307130191 | 主要负责数据库设计以及前后端的部分动态交互以及少量的前端工作，还有数据库数据的收集 |
| 解润芃 |17307130196 | 主要负责游戏机制的设计，前端设计，少部分数据库设计，一些功能调整，以及大部分数据库与后端交互 |

### 1.3 运行方式

```
$ pip install Django 		   //安装Django框架
$ pip install pillow		   //Django中涉及到图片的使用，需要一个第三方库
$ python manage.py runserver   //启动服务器
```

在浏览器中输入http://127.0.0.1:8000/ 即可访问。

### 1.4 Django简介

　　Django是由Python写成的一个开放源代码的Web应用框架，它封装了前端(html)-后端(python)-数据库(sqlite)，使得程序员可以专注于编写应用程序。在传统的数据驱动网站中，Web应用程序会等待来自Web浏览器的 HTTP 请求。当接收到请求时，应用程序根据 URL 和可能的 POST 数据或 GET 数据中的信息确定需要的内容。根据需要，可以从数据库读取或写入信息，或执行满足请求所需的其他任务。然后，该应用程序将返回对Web浏览器的响应，通常通过将检索到的数据插入HTML模板中的占位符来动态创建用于浏览器显示的 HTML 页面。而Django网络应用程序则通常将处理每个步骤的代码分组到单独的文件中：

<img src="https://gitee.com/sunflower_wiki/Pictures-For-Lab/raw/master/Database/basic-django.png" >

- **URLs:** URL映射器用于根据请求URL将HTTP请求重定向到相应的视图。URL映射器还可以匹配出现在URL中的字符串或数字的特定模式，并将其作为数据传递给视图功能。
- **View:**  视图是一个请求处理函数，它接收HTTP请求并返回HTTP响应。视图通过模型访问满足请求所需的数据，并将响应的格式委托给模板。
- **Models:**  模型是定义应用程序数据结构的Python对象，并提供在数据库中管理（添加，修改，删除）和查询记录的机制。
- **Templates:** 模板是定义文件（例如HTML页面）的结构或布局的文本文件，用于表示实际内容的占位符。一个视图可以使用HTML模板，通过数据填充它可以动态地创建一个HTML页面模型。



## 2 项目细节

### 2.1 概述——游戏核心机制

### 2.2 主人视角

在这一个部分，我们主要从主人的视角理解Cat-World中主人可以执行的操作。我们功能的讲解同时会对整个界面分布也做一个简单地介绍。

#### 2.2.1 Home

这是用户的根界面，里面记录了主人的基本信息，比如金钱等，同时有一些相对复杂的信息，比如主人有哪些食物、有哪些猫，等等。下面按照编号依次讲解。

<div>
    <img src="Pics/home.jpg">
</div>
| 标号 | 信息/功能      | 标号 | 信息/功能 | 标号 | 信息/功能 |
| ---- | -------------- | ---- | --------- | ---- | --------- |
| 1    | 主人姓名及性别 | 7    | 链接：到达Markets界面 | 13   | 填写猫咪姓名 |
| 2    | 主人猫咪数量               | 8    | 退出登录 | 14   | 选择猫咪性别 |
| 3    | 账户余额 | 9    | 猫咪姓名及性别 | 15   | 选择猫咪饥饿状态 |
| 4    | 链接：到达Home界面 | 10   | 猫咪饥饿状态 | 16   | 提交表单 |
| 5    | 链接：到达CatWiki界面 | 11   | 猫咪图片 | 17   | 主人的背包中食物及数量 |
| 6    | 链接：到达Parks界面 | 12   | 喂食按钮 | 18   | 提示信息 |

\*一些简单地解释（根据标号）：

- 3：这是主人的资金，用来购买食物喂猫。
- 9：猫咪的性别不仅可以通过性别符号表示，同时卡片的背景也暗示着猫咪的性别。在这里蓝色小卡片是雄猫，而黄色是雌猫。
- 10：猫咪的饥饿状态会由于喂食或者时间推移而变化。
- 12：选择喂食的食物，从主人背包中选择。
- 13、14、15、16：一个简单地猫咪筛选器，可以寻找所有满足条件的猫咪。
- 17：主人的背包，里面的食物从商店购买，会因为喂猫而消耗。

#### 2.2.2 Cat Wiki

这个界面可以查看到在所有公园的所有猫，可以看到它们的主人信息以及进行简单搜索。

<div>
    <img src="Pics/catwiki.jpg">
</div>
1. 猫咪卡片流：所有公园中的所有猫的猫。
2. 猫咪的名字和性别。
3. 猫咪目前的主人是谁，如果没有，显示wild。
4. 猫咪当前的饥饿状态。
5. 猫咪筛选器：和Home的略有不同，这里你可以看见主人信息，所以你可以添加关于主人信息的筛选。
6. 背包，如同Home中相同位置的功能。

#### 2.2.3 Parks & Park

**Parks**

这是小公园列表，这里你可以找到所有的小公园，并且选择进入小公园。

**Park**

这是主人与野生小天使交互的地方。你可以选择喂食猫咪，并且赢得猫咪的青睐。亲密度到达一定程度时，猫咪会请求加入你的猫咪大家庭。这个界面布局和Home界面几乎完全一样，故不再赘述。

#### 2.2.4 Markets & market

**markets**

这是小市场列表，这里你可以找到所有的小市场，查看管理员的消息，并且和所有的市场管理员对话。当然你可以看见你的背包信息。

<div>
    <img src="Pics/markets.jpg">
</div>

| 标号 | 信息/功能    | 标号 | 信息/功能    |
| ---- | ------------ | ---- | ------------ |
| 1    | 小市场卡片流 | 6    | 选择聊天对象 |
| 2    | 小市场图片   | 7    | 提交表单     |
| 3    | 小市场名字   | 8    | 聊天记录表   |
| 4    | 背包信息     | 9    | 删除按钮     |
| 5    | 聊天内容     | 10   | 聊天信息     |

\*一些简单地解释（根据标号）：

- 5，6，7：这是一个简单地对话系统，主人可以选择和一个店老板聊天，输入一条留言，这样这个店老板就能看见你的留言。
- 8，9，10：这是聊天记录表，这里你可以看见你和各个店老板的聊天记录，包含你和谁的对话，谁说的这句话，对话的内容等等信息。当然，你可以删掉任意一个对话。在这里茶色的句子表示这是主人的留言的，蓝色的句子表示店老板的留言。

**market**

在market界面下，主人可以买卖食物。或者购买食物喂食野生的/家养的小天使，或者通过在不同商店间不断地往返来利用不同商店间的差价来获取盈利。当然，你赚到的钱最后还是进入了小猫咪的嘴里。同时，你可以简单地给店老板写留言，只是简单聊几句或者对于价格有所不满都是可以的。

<div>
    <img src="Pics/market.jpg">
</div>

| 标号 | 信息/功能    | 标号 | 信息/功能    |
| ---- | ------------ | ---- | ------------ |
| 1    | 食物卡片流 | 7   | 购买 |
| 2    | 食物的图片 | 8   | 售出 |
| 3    | 食物的名字 | 9   | 背包列表 |
| 4   | 食物的价格 | 10  | 留言系统 |
| 5    | 小市场余量 | 11 | 聊天信息 |
| 6     | 操作的数量 | 12 |  |

\*一些简单地解释（根据标号）：

- 4：食物的价格总是变动的，在不同的小市场，相同的商品价格仍然可以不一样。
- 5：小市场的余量。小市场会进货，但是你总是不可以买比供应量更多的食物。
- 10，11：在这里，你只可以留言给当前市场的店老板，并且仅能看到你和这个店老板的交流情况。

#### 2.2.5 小结

这样我们结束了作为主人的全部探索。我们总结一下作为一个主人我们可以做什么。

- 在各个地区走来走去。
- 喂养家中或者公园中的小猫咪。
- 在不同的小市场购买或者售出食物。
- 通过猫咪筛选器选择自己心仪的小猫咪。
- 与所有小市场的店老板聊天，查看聊天并且删除聊天。
- 查看个人基本信息、背包内容等。

### 2.3 管理员视角

管理员的视角非常简单。管理员能看见的一切都是关于店铺的。一个管理员可以看见店铺中所有商品的价格以及数量。并且他可以知道市场上所有的食物有哪些。它可以进货或者卖出一定数量的食物，同时可以修改食物的价格。一个管理员可以看见主人和市场店老板的聊天，添加/删除和自己顾客的聊天。

<div>
    <img src="Pics/manage.jpg" style="zoom:20%">
    <img src="Pics/manage2.jpg" style="zoom:20%">
</div>

| 标号 | 信息/功能    | 标号 | 信息/功能    |
| ---- | ------------ | ---- | ------------ |
| 1    | 管理员姓名及性别 | 7   | 市场储藏列表 |
| 2    | 管理员管理的小市场 | 8   | 留言信息 |
| 3    | 市场可选食物 | 9   | 留言对象 |
| 4   | 食物卡片 | 10  | 提交表单 |
| 5    | 食物在该市场中价格 | 11 | 聊天信息 |
| 6     | 修改按钮 | 12 |  |

- 4：食物卡片，管理员可以在食物相应的卡片上购买一定量或者售出一定量的食物。当然你不可以售出比自己库存更多的食物。
- 7：管理员特有的功能面板，可以用于修改在该市场中的食物的价格。
- 8，9，10，11：聊天系统，大致功能与符号表示与主人界面一致。不一样的是这里选择的对话对象是与该店铺发生交流的主人。

## 3 数据库简介

### 3.1 数据库设计

#### 3.1.1 ER图

  <img src="https://gitee.com/sunflower_wiki/Pictures-For-Lab/raw/master/Database/ER%20picture.jpg">

#### 3.1.2 模型设计（表格，实体，主键、外键等等）

### 3.2 涉及数据库的操作

#### 3.2.1 面向主人的操作

- 注册账号
- 登陆账号
- 个人信息
  - 查看背包
  - 查看基本信息
  - 查看拥有猫咪
  - 喂食家中猫咪
- 查看所有猫咪信息
- 猫咪筛选器
- 公园相关
  - 查看公园列表
  - 查看公园中猫咪情况
  - 喂食公园中猫咪
  - 领养猫咪
- 市场相关
  - 查看市场列表
  - 查看市场售卖食物
  - 买食物
  - 卖食物
  - 查看与商店管理员的对话
  - 创建与商店管理员的对话
  - 删除与商店管理员的对话

#### 3.2.2 面向管理者的操作

- 登入管理员界面
- 查看个人信息
- 查看仓库情况
- 查看所有食物情况
- 调整食物价格
- 调整进货情况
  - 买入货物
  - 卖出货物
- 与买家对话系统
  - 查看对话
  - 创建对话
  - 删除对话

#### 3.2.3 一些潜在的操作

- 食物的随即生成
- 食物价格的随机波动
- 猫的随机生成
- 猫的饥饿机制
- 猫的逃离机制

## 4 web界面介绍

本部分主义主要涉及Cat-World的界面设计。我们会在这里提及设计理念以及对于界面主要功能的讲解和简单展示。

#### 4.1 设计理念

Cat-World严格遵从2014年谷歌公司为移动端设备推出的Material Design涉及规范（后简称MD）。我们希望借助最为简单的、有秩序的、一致的元素传递有效的、丰富的、易于阅读的信息。通过在静态界面上融入一些简易的、富有提示性的交互，我们希望提供用户亲切、自然的游戏体验。

#### 4.2 布局

为了更为友好的用户体验，我们希望通过我们的布局传达出更加有效的信息。我们希望做到即使在不同界面，相似的位置所承载的功能也应当是相似的，从而使用户可以通过简单地注意到卡片的位置意识到功能而非通过抓取文字。 

于是我们采用功能上统一的布局，将一个web界面分为三栏设计（称为左栏、右栏、中部）。左栏为信息栏与功能栏，用户可以找到自己的基本信息，以及通过相应的按钮到达相应的功能分区。右栏为操作栏，这里集中了大部分用户与所在页面的交互功能，用户可以通过在操作栏上做一定的操作，例如建立与管理者的对话、使用Cat-Filter查询想要找到的猫咪。而中部分割为上下两个部分，其上部分为欢迎等界面提示语句，而下部统一为“卡片流”，即秩序排布的卡片序列，这些卡片根据界面不同而呈现不一样的内容。在不同的界面，卡片上可能会提供相应的简单操作，例如喂食猫咪等。

显然，这样的布局使得玩家即使在任何一个界面都不应该感到陌生，知道自己所在的位置（通过提示语句），知道自己可以进行的操作（通过右栏）。

#### 4.3 元素

**卡片**

MD规范的主要元素即是“卡片(card)”。卡片是一种有效的信息载体，它可以清晰地呈现一个对象的相关信息，提供包括图片、符号、文字、颜色等多类信息，并且以非常明显的边界与其他信息划分开。毫无疑问，采用卡片结构，用户总是知道每一个文字的意义是针对什么部分的，并且很难在浏览过程中丧失焦点。

而Cat-World通过卡片呈现几乎所有的信息。在我们的设计中，卡片是信息以及交互的唯一展示容器。我们将右栏中不同的功能整理为不同的卡片，使得功能分区非常明显，并且富有秩序性。

即使采用卡片，仍可以有很大的发挥空间。我们针对不相同的信息做出了不一样风格的卡片。如“食物的卡片”，“公园的卡片”，“猫的卡片”，“功能区的卡片”。这些卡片呈现出明显的区别，但又因为相同的圆角、基色等原因结合在一起，以即统一又多样的方式构成了用户所看见的一切。

**符号**

符号是一种较文字更为清晰、友好的交互元素，一旦使用的符号是被人们所理解时。Cat-World采用了MD规范提供的icon规范——这个规范在大部分遵守MD设计规范的Android以及web应用中非常常见。这些符号，由于为移动端设计，本身具有线条简单、意义清晰等重要的性质，其在这样一个简单地游戏框架中展现出良好的效果。

#### 4.4 主题

Cat-World是一个喂养猫咪的游戏，毫无疑问，其面向对象为富有爱心、爱猫的玩家。所以我们希望尽可能地是我们的主题显得亲切、温暖、轻松。于是我们使用暖色作为界面的底色；但是只是使用暖色调容易使人在浏览过程中感到乏味，于是我们加入了点缀式的中性或者偏冷的色调完成其他细节信息的展示。同样白色的出现是必要的，白色给人一种平缓的感觉。

#### 4.5 动画&交互

**动画**

Cat-World的设计理念中“简单”毫无疑问是最为重要的。我们希望动画或者交互的功能应当是提示性的、潜在的或者使人感到惊喜的，而非是使得界面由于具有过多无意义的动画而丧失主题。所以在动画以及交互的设计中，我们采用的动画或是必要的，或是在浏览过程中使人感到舒适或者惊奇的。

我们主要的动画分为进场动画，以及潜在动画。进场动画指进入这个界面时，在界面上相应的组件到达其位置工程中的呈现。我们使用了一个“向中央移动”的统一风格完成进场动画。在布局中我们曾提到了三栏布局，在设计中，我们固定住左栏，因为它的信息没有任何变化，过多的动画会分散用户注意力；而活动右栏，中部的上下两部分：右栏从web右端进入视线，中部两部分分别从上下进入视线，从而呈现出从周围向中央移动的效果。

这样的移动是秩序的、富有提示性的。同时通过这样”清零从来“的动画提示用户功能区的转化，完成界面信息和意义的刷新。

**交互**

交互相当的简单。用户通过点击界面上的按钮实现不同的功能，通过界面呈现的信息获取反馈。部分信息会通过中部的上栏提示语句，或者通过弹窗的模式得到。我们希望，重要的信息，用户是应当知道的。除此之外，我们采用了一点点有意思的潜在交互。当用户移动到某些特殊的区域时，相应的组件会以意想不到的方式开始简单地抖动。当这个特效使用在猫咪卡片的时候，它的效果是非常棒的。当然一些文字的抖动使得这个游戏更加亲切、自由。


## 5 参考

### 5.1 web模块连链接

### 5.2 参考教程以及文献



